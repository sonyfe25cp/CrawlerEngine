<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
 	http://www.springframework.org/schema/beans/spring-beans-3.0.xsd">

	<bean id="pageSaver" class="bit.crawl.pagesavers.PageStorePageSaver"
		destroy-method="close">
		<property name="taskName" value="sohu-society" />
		<property name="baseDir" value="crawled-pages" />
	</bean>

	<bean id="crawler" class="bit.crawl.crawler.Crawler">
		<property name="maxThreads" value="20" />
		<property name="maxDepth" value="5" />
		<property name="encoding" value="GB18030" />
		<property name="initialUrls">
			<list>
				<value>http://news.sohu.com/shehuixinwen.shtml</value>
			</list>
		</property>
		<property name="filterRules">
			<list>
				<bean class="bit.crawl.crawler.FilterRule"
					p:pattern="http://news.sohu.com/\d+/n\d+.shtml"
					p:action="STORE" />
				<bean class="bit.crawl.crawler.FilterRule"
					p:pattern="http://news.sohu.com/bagua(_\d+).shtml"
					p:action="FOLLOW" />
				<bean class="bit.crawl.crawler.FilterRule"
					p:pattern="http://news.sohu.com/shehuixinwen.shtml"
					p:action="FOLLOW" />
				<bean class="bit.crawl.crawler.FilterRule"
					p:pattern=".*"
					p:action="AVOID" />
			</list>
		</property>

		<property name="pageListeners">
			<list>
				<ref bean="pageSaver" />
			</list>
		</property>
	</bean>

	<bean id="extractor" class="bit.crawl.extractor.Extractor">
		<property name="processorRules">
			<list>
				<bean class="bit.crawl.extractor.UrlProcessorRule">
					<property name="urlPattern" value="http://news.sina.com.cn/s/(p/)?[0-9\-]+/([0-9a-zA-Z]+).shtml" />
					<property name="dbName" value="news" />
					<property name="processor">
						<bean class="bit.crawl.extractor.processor.JhqlProcessor">
							<property name="expression">
								<value><![CDATA[
									{
										"origin": "literal:sohu",
										"url": "context:URL",
										"title": "text:.//h1",
										"date": {
											"_type": "date",
											"value": ".//div[@class='sourceTime']/div[@class='r']",
											"dateFormat": "yyyy年MM月dd日HH:mm"	
										},
										"content": "text:.//*[@id='contentText']",
										"keywords": "text:.//meta[@name='keywords']/@content",
										"description": "text:.//meta[@name='description']/@content"
									}
									]]>
								</value>
							</property>
						</bean>
					</property>
				</bean>
			</list>
		</property>
	</bean>
</beans>

